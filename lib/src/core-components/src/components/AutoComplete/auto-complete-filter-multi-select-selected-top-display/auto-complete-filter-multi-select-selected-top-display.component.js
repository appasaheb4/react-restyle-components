"use strict";import{jsx as l,jsxs as o,Fragment as X}from"react/jsx-runtime";import{useState as v,useEffect as M,useRef as Y}from"react";import{Icon as y}from"../../Icon/Icon";import{debounce as T}from"@techabl/core-utils";import e from"../../../tc.module.css";import{cn as t}from"../../../utils";export const AutoCompleteFilterMultiSelectSelectedTopDisplay=({uniqueField:i="_id",loader:_=!1,placeholder:D="Search...",data:n,hasError:S=!1,disable:U=!1,isUpperCase:$=!1,name:B,showSelectAllSection:R=!0,onFilter:b,onUpdate:g,onSelect:N,onBlur:O,dynamicCheck:k="panelCode"})=>{const[j,w]=v(""),[a,A]=v([]),[Q,V]=v([]),[p,I]=v(!1),G=s=>{M(()=>{function r(c){if(s.current&&!s.current.contains(c.target)&&p){if(Q&&a&&p){const d=a.filter(h=>h.selected),m=n.selected||[],u=new Map;d.forEach(h=>{u.set(h[i],h)}),m.forEach(h=>{a.some(W=>W[i]===h[i])||u.set(h[i],h)});const x=Array.from(u.values());g&&g(x)}I(!1),w("")}}return document.addEventListener("mousedown",r),()=>{document.removeEventListener("mousedown",r)}},[s,p])},z=Y(null);G(z);let E=0;const L=(s,r)=>(E===0&&(r=r?.filter((d,m)=>(d.selected=!1,s&&s.length>0?s?.find((u,x)=>{u[i]===d[i]&&(d.selected=!0)}):d.selected=!1,E++,d))),r);M(()=>{V(L(n.selected,n.list)),A(L(n.selected,n.list))},[n,n.selected]);const H=s=>{const r=s.target.value;w(r),T(()=>{b&&b(r)})},J=s=>{if((s.which?s.which:s.keyCode)===8){const c=s.target.value;T(()=>{b&&b(c)})}},K=s=>{const r=a.map(c=>({...c,selected:s}));A(r),N(r)},C=()=>a?a?.filter(r=>!n.selected?.some(d=>d[k]===r[k])).length:0,f=()=>n.selected?.length||0,P=()=>a?.length||0;return l(X,{children:o("div",{ref:z,className:t(e["w-full"],e.relative),children:[o("div",{className:t(e.flex,e["items-center"],e["leading-4"],e["p-2"],e["focus:outline-none"],e["focus:ring"],e["w-full"],e["shadow-sm"],e["sm:text-base"],e.border,e["rounded-md"],{[e["border-red"]]:S,[e["border-gray-300"]]:!S},e["bg-white"]),children:[l("input",{placeholder:D,disabled:U,name:B,value:p?$?j?.toUpperCase():j:`${f()} Items Selected`,className:t(e["w-full"],e["focus:outline-none"],e["bg-transparent"]),onKeyUp:J,onChange:H,onClick:()=>I(!0),onBlur:s=>O&&O(s)}),_?l("div",{className:t(e["animate-spin"],e["w-4"],e["h-4"]),children:l(y,{nameIcon:"FaSpinner",propsIcon:{size:16,color:"#666"}})}):l(y,{nameIcon:p?"FaChevronUp":"FaChevronDown",propsIcon:{size:16,color:"#000000"}})]}),p&&o("div",{className:t(e["mt-1"],e.absolute,e["rounded-md"],e["bg-white"],e.border,e["border-gray-300"],e["shadow-lg"],e["z-50"],e["w-full"],e["max-h-96"],e["overflow-hidden"]),style:{zIndex:1e3},children:[l("div",{className:t(e["p-3"],e["border-b"],e["border-gray-200"],e["bg-gray-50"],e["text-sm"],e["font-medium"],e["text-gray-700"]),children:o("div",{className:t(e.flex,e["justify-between"],e["items-center"]),children:[o("span",{children:["Total Items: ",P()]}),o("div",{className:"flex items-center gap-2",children:[o("span",{className:t(e["text-blue-600"]),children:[f()," Selected"]}),l("div",{className:t(e.flex,e["gap-2"]),children:l("button",{type:"button",className:t(e["text-xs"],e["px-3"],e["py-1"],e["bg-blue-600"],e["text-white"],e.rounded,e["hover:bg-blue-700"],e["transition-colors"]),onClick:()=>{const s=a.filter(m=>m.selected),r=n.selected||[],c=new Map;s.forEach(m=>{c.set(m[i],m)}),r.forEach(m=>{a.some(x=>x[i]===m[i])||c.set(m[i],m)});const d=Array.from(c.values());g&&g(d),I(!1),w("")},children:"OK"})})]})]})}),R&&o("div",{className:t(e["p-3"],e["border-b"],e["border-gray-200"],e["bg-gray-50"],e.flex,e["justify-between"],e["items-center"]),children:[l("span",{className:t(e["text-sm"],e["font-medium"],e["text-gray-700"]),children:"Quick Actions"}),o("div",{className:t(e.flex,e["gap-2"]),children:[l("button",{type:"button",onClick:()=>K(!0),className:t(e["text-xs"],e["px-3"],e["py-1"],e["bg-green-500"],e["text-white"],e.rounded,e["hover:bg-green-600"],e["transition-colors"],C()===0&&e["opacity-50"],C()===0&&e["cursor-not-allowed"]),disabled:C()===0,title:"Select all available items",children:"Select All"}),l("button",{type:"button",onClick:()=>K(!1),className:t(e["text-xs"],e["px-3"],e["py-1"],e["bg-gray-500"],e["text-white"],e.rounded,e["hover:bg-gray-600"],e["transition-colors"],f()===0&&e["opacity-50"],f()===0&&e["cursor-not-allowed"]),disabled:f()===0,title:"Deselect all selected items",children:"Clear All"})]})]}),o("div",{className:t(e["max-h-80"],e["overflow-y-auto"]),children:[n.selected&&n.selected.length>0&&o("div",{className:t(e["border-b"],e["border-gray-200"]),children:[l("div",{className:t(e["p-3"],e["bg-blue-50"],e["border-b"],e["border-blue-200"],e["font-semibold"],e["text-sm"],e["text-blue-700"]),children:o("div",{className:t(e.flex,e["items-center"],e["gap-2"]),children:[l(y,{nameIcon:"FaCheck",propsIcon:{size:12,color:"#1976d2"}}),o("span",{children:["Selected Items (",n.selected.length,")"]})]})}),l("div",{className:t(e["max-h-48"],e["overflow-y-auto"]),children:n?.selected?.map((s,r)=>l("div",{className:t(e.flex,e["items-center"],e["gap-3"],e["p-3"],e["hover:bg-blue-50"],e["border-l-4"],e["border-blue-500"],e["bg-blue-25"],e["transition-colors"]),children:o("label",{className:t(e.flex,e["items-center"],e["cursor-pointer"],e["w-full"]),children:[l("input",{type:"checkbox",checked:!0,onChange:()=>N([{...s,selected:!s.selected}]),className:t(e["h-4"],e["w-4"],e["text-blue-600"],e["border-gray-300"],e.rounded,e["focus:ring-blue-500"],e["cursor-pointer"])}),l("div",{className:t(e["ml-3"],e.flex,e["flex-col"]),children:l("span",{className:t(e["text-sm"],e["font-medium"],e["text-blue-700"]),children:n.displayKey?.map(c=>s[c]).filter(Boolean).join(" - ")||"Unnamed Item"})})]})},`selected-${r}`))})]}),a&&a.length>0&&l("div",{children:l("div",{className:t(e["max-h-60"],e["overflow-y-auto"]),children:a?.filter(s=>!n.selected?.some(c=>c[i]===s[i]))?.map((s,r)=>l("div",{className:t(e.flex,e["items-center"],e["gap-3"],e["p-3"],e["hover:bg-gray-50"],e["border-l-4"],e["border-transparent"],e["transition-colors"]),children:o("label",{className:t(e.flex,e["items-center"],e["cursor-pointer"],e["w-full"]),children:[l("input",{type:"checkbox",checked:s.selected||!1,onChange:()=>N([{...s,selected:!s.selected}]),className:t(e["h-4"],e["w-4"],e["text-blue-600"],e["border-gray-300"],e.rounded,e["focus:ring-blue-500"],e["cursor-pointer"])}),l("div",{className:t(e["ml-3"],e.flex,e["flex-col"]),children:l("span",{className:t(e["text-sm"],e["font-medium"],e["text-gray-700"]),children:n.displayKey?.map(c=>s[c]).filter(Boolean).join(" - ")||"Unnamed Item"})})]})},`available-${r}`))})}),(!a||a.length===0)&&o("div",{className:t(e["p-4"],e["text-center"],e["text-gray-500"]),children:[l(y,{nameIcon:"FaSearch",propsIcon:{size:24,color:"#ccc"}}),l("p",{className:t(e["mt-2"],e["text-sm"]),children:"No items found"}),l("p",{className:t(e["text-xs"]),children:"Try adjusting your search terms"})]})]})]})]})})};
