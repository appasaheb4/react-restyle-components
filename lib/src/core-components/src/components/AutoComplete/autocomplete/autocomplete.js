"use strict";import{jsx as f,Fragment as Se,jsxs as j}from"react/jsx-runtime";import{useState as R,useRef as D,useEffect as L,useCallback as h}from"react";import{Icon as z}from"../../Icon/Icon";import e from"../../../tc.module.css";import{cn as d}from"../../../utils";const ve=34;export const Autocomplete=({value:i="",onValueChange:O,options:o=[],filterConfig:ne={},displayConfig:ie={},keyboardConfig:le={},uiConfig:se={},hasError:k=!1,disabled:w=!1,name:oe,className:ce,style:ae,inputClassName:fe,onInputValueChange:H,onOpen:y,onClose:u,onSelect:M,autoFocus:G=!1})=>{const{enabled:q=!0,caseSensitive:_=!1,filterFn:K,minCharacters:A=0}=ne,{renderOption:B,renderEmptyState:J,highlightActive:C=!0,activeOptionClassName:ue,optionClassName:de}=ie,{enabled:P=!0,selectKeys:Q=["Enter"],closeKeys:X=["Escape"],enterToSelect:Z=!0,escapeToClose:V=!0}=le,{placeholder:me="Search...",emptyStateMessage:ge="Not Found Result!!",itemHeight:U=ve,maxHeight:he,zIndex:pe=999,showOnFocus:ee=!0,showOnClick:te=!0,autoSelectFirst:re=!0}=se,m=h(t=>typeof t=="string"?t:t.label,[]),T=h(t=>typeof t=="string"?t:String(t.value),[]),Ne=h(()=>{if(!i||o.length===0)return 0;const t=o.findIndex(r=>T(r)===i||m(r)===i);return t!==-1?t:0},[i,o,T,m]),[c,I]=R(()=>{if(!i||o.length===0)return 0;const t=o.findIndex(r=>(typeof r=="string"?r:String(r.value))===i||(typeof r=="string"?r:r.label)===i);return t!==-1?t:0}),[a,S]=R(o),[l,b]=R(!1),[g,v]=R(i),E=D(null),W=D(null),Y=D(null),$=D(!1),N=D(null),p=h(t=>{if(!q||t.length===0&&A===0)return o;if(t.length<A)return A===0?o:[];if(K)return o.filter(n=>K(n,t));const r=_?t.trim():t.trim().toLowerCase();return r.length===0?o:o.filter(n=>{const s=m(n);return(_?s.trim():s.trim().toLowerCase()).includes(r)})},[o,q,_,K,A,m]),xe=h(t=>{const r=t.target.value;$.current=!0,N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{$.current=!1},300),H&&H(r),v(r);const n=p(r);S(n),I((n.length>0,0)),(n.length>0||r.length>0)&&b(!0)},[p,H]),F=h((t,r)=>{const n=m(t);b(!1),I(0),S([]),v(n),O(t),M&&M(t),u&&u()},[O,M,u]),ye=h(t=>{const r=parseInt(t.currentTarget.getAttribute("data-index")||"0",10),n=a[r];n&&F(n,r)},[a,F]),be=h(t=>{if(!P)return;const r=t.key,n=t.keyCode;if(n===38||r==="ArrowUp"){if(t.preventDefault(),c>0){const s=c-1,x=a[s];I(s),v(m(x)),W.current?.scroll({top:U*s,behavior:"smooth"})}return}if(n===40||r==="ArrowDown"){if(t.preventDefault(),c<a.length-1){const s=c+1,x=a[s];I(s),v(m(x)),W.current?.scroll({top:U*s,behavior:"smooth"})}return}if((n===13||r==="Enter")&&Z){if(t.preventDefault(),a.length>0&&c>=0){const s=a[c];F(s,c)}return}if((n===27||r==="Escape")&&V){t.preventDefault(),b(!1),u&&u();return}if(Q.includes(r)&&a.length>0&&c>=0){t.preventDefault();const s=a[c];F(s,c)}X.includes(r)&&(t.preventDefault(),b(!1),u&&u())},[P,c,a,U,Z,V,Q,X,F,u]),we=h(()=>{if(ee&&!l){const t=p(g);S(t),b(!0),y&&y()}},[ee,l,y,p,g]),Ie=h(()=>{if(te&&!l){const t=p(g);S(t),b(!0),y&&y()}},[te,l,y,p,g]),ke=h(()=>{if(!w)if(l)b(!1),u&&u();else{const t=p(g);S(t),b(!0),E.current?.focus(),y&&y()}},[w,l,y,u,p,g]),Te=()=>l?j("div",{className:d(e.absolute,e["w-full"],e["rounded-lg"],e["bg-white"],e.border,e["border-gray-200"],e["shadow-lg"],e["overflow-hidden"]),style:{position:"absolute",top:"calc(100% + 0.5rem)",left:0,right:0,margin:0,padding:0,zIndex:pe,animation:"fadeIn 0.15s ease-out",transformOrigin:"top"},children:[f("style",{children:`
          @keyframes fadeIn {
            from {
              opacity: 0;
              transform: translateY(-8px) scale(0.98);
            }
            to {
              opacity: 1;
              transform: translateY(0) scale(1);
            }
          }
        `}),a.length>0?f("ul",{role:"listbox",className:d(e.flex,e["flex-col"],e["w-full"],e["overflow-y-auto"],e["overflow-x-hidden"]),id:"autocomplete-list",ref:W,style:{maxHeight:he||"300px",scrollbarWidth:"thin",margin:0,padding:0,listStyle:"none"},children:a.map((t,r)=>{const n=C&&r===c;let s=d(e.flex,e["items-center"],e["px-4"],e["py-3"],e["cursor-pointer"],e["text-sm"],e["transition-all"],e["duration-150"],e["ease-in-out"],de);return n&&C&&(s=d(s,e["bg-blue-50"],e["text-blue-700"],e["font-medium"],ue)),f("li",{className:s,role:"option","aria-selected":n,id:`autocomplete-option-${r}`,"data-index":r,onClick:ye,onMouseEnter:()=>I(r),style:{margin:0,padding:"0.75rem 1rem",listStyle:"none",transition:"background-color 0.15s ease, color 0.15s ease",backgroundColor:n&&C?"rgb(239, 246, 255)":"transparent",color:n&&C?"rgb(29, 78, 216)":"rgb(55, 65, 81)"},onMouseOver:x=>{n||(x.currentTarget.style.backgroundColor="rgb(239, 246, 255)",x.currentTarget.style.color="rgb(29, 78, 216)")},onMouseOut:x=>{n||(x.currentTarget.style.backgroundColor="transparent",x.currentTarget.style.color="rgb(55, 65, 81)")},children:B?B(t,r,n):f("span",{className:d(e["select-none"]),children:m(t)})},r)})}):f("div",{className:d(e.flex,e["flex-col"],e["items-center"],e["justify-center"],e["px-4"],e["py-3"],e["text-center"]),style:{margin:0,padding:0},children:J?J():j(Se,{children:[f(z,{nameIcon:"FaSearch",propsIcon:{size:32,color:"#9ca3af"}}),f("p",{className:d(e["mt-3"],e["text-sm"],e["font-medium"],e["text-gray-500"]),children:ge}),f("p",{className:d(e["mt-1"],e["text-xs"],e["text-gray-400"]),children:"Try adjusting your search"})]})})]}):null;return L(()=>{const t=p(g);if(S(t),t.length>0){const r=t.findIndex(n=>T(n)===i||m(n)===i);r!==-1?I(r):c>=t.length&&I(0)}else t.length===0&&g.length===0&&I(0)},[o,g,p,i,c,T,m]),L(()=>{G&&setTimeout(()=>{E.current?.focus(),E.current?.select()},0),re&&a.length>0&&!i&&O(a[0])},[G,re,a,i,O]),L(()=>{if(!$.current&&i!==g){const t=o.find(r=>T(r)===i||m(r)===i);t?v(m(t)):i&&v(i)}},[i,o,g,T,m]),L(()=>{function t(r){Y.current&&!Y.current.contains(r.target)&&l&&(b(!1),u&&u())}return l&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[l,u]),L(()=>()=>{N.current&&clearTimeout(N.current)},[]),j("div",{ref:Y,className:d(e.flex,e["flex-col"],e.relative,e["w-full"],ce),style:{...ae,position:"relative",margin:0},children:[f("div",{className:d(e.flex,e["items-center"],e.relative,e["w-full"],e["bg-white"],e.border,e["rounded-lg"],e["shadow-sm"],e["transition-all"],e["duration-200"],e["ease-in-out"],e["overflow-hidden"],{[e["border-red-500"]]:k,[e["border-gray-300"]]:!k&&!l,[e["border-blue-500"]]:!k&&l,[e["ring-2"]]:!k&&l,[e["ring-blue-200"]]:!k&&l,[e["opacity-50"]]:w,[e["cursor-not-allowed"]]:w}),style:{boxShadow:l&&!k?"0 0 0 3px rgba(59, 130, 246, 0.1)":"0 1px 2px 0 rgba(0, 0, 0, 0.05)",overflow:"hidden"},children:j("div",{className:d(e.flex,e["items-center"],e["w-full"],e.relative),style:{padding:"0.5rem 0.75rem",minWidth:0},children:[f("div",{className:d(e["mr-2"],e["flex-shrink-0"]),style:{display:"flex",alignItems:"center"},children:f(z,{nameIcon:"FaSearch",propsIcon:{size:18,color:l?"#3b82f6":"#9ca3af"}})}),f("input",{type:"text",role:"combobox","aria-autocomplete":"list","aria-expanded":l,"aria-controls":"autocomplete-list","aria-activedescendant":l&&c>=0?`autocomplete-option-${c}`:void 0,name:oe||"autocomplete-input",className:d(e["flex-1"],e["bg-transparent"],e["text-sm"],e["text-gray-700"],e["placeholder-gray-400"],e["focus:outline-none"],e["border-none"],e["focus:ring-0"],fe),placeholder:me,onChange:xe,onKeyDown:be,onFocus:we,onClick:Ie,value:g,ref:E,disabled:w,autoComplete:"off",style:{cursor:w?"not-allowed":"text",minWidth:0,flex:"1 1 0%",width:0}}),f("div",{className:d(e["flex-shrink-0"],e.flex,e["items-center"],e["justify-center"],e["cursor-pointer"]),onClick:ke,style:{marginLeft:"0.5rem",transition:"transform 0.2s ease",display:"flex",alignItems:"center",justifyContent:"center",cursor:w?"not-allowed":"pointer"},children:l?f(z,{nameIcon:"FaChevronUp",propsIcon:{size:16,color:w?"#9ca3af":"#3b82f6"}}):f(z,{nameIcon:"FaChevronDown",propsIcon:{size:16,color:"#9ca3af"}})})]})}),Te()]})};
