"use strict";import{jsx as n,jsxs as b,Fragment as he}from"react/jsx-runtime";import Se,{useState as _,useEffect as P,useRef as q}from"react";import{Icon as V}from"../../Icon/Icon";import{LoadingAnimateSpin as xe}from"../../Loader/loader.component";import{DndContext as ve,closestCenter as Ie,useSensor as we,useSensors as be,PointerSensor as _e}from"@dnd-kit/core";import{arrayMove as ye,SortableContext as Ne,useSortable as De,horizontalListSortingStrategy as $e}from"@dnd-kit/sortable";import{CSS as ke}from"@dnd-kit/utilities";import e from"../../../tc.module.css";import{cn as l}from"../../../utils";export const DraggableSelectedItem=({item:r,index:c,onRemove:y,displayKey:N,uniqueField:i="sort",displayConfig:h={},className:O,style:L})=>{const{attributes:D,listeners:S,setNodeRef:d,transform:T,transition:E,isDragging:R}=De({id:r[i]||r.sort||c.toString()}),x={transform:ke.Transform.toString(T),transition:E,opacity:R?.5:1,...L},$=()=>{const v=h.displayKeys||N||["name","code"],z=h.displaySeparator||" - ";return v.map(A=>r[A]).filter(Boolean).join(z)||"Unnamed Item"},j=v=>{v.stopPropagation(),y(c)};return h.renderSelectedBadge?n("div",{ref:d,style:x,...D,...S,children:h.renderSelectedBadge(r,c,()=>y(c))}):b("div",{ref:d,style:x,...D,...S,className:l(e.flex,e["text-white"],e["gap-1"],e["bg-blue-500"],e["p-1"],e.rounded,e["cursor-move"],O),children:[n("div",{className:l(e.flex,e["w-fit"],e["cursor-pointer"],e["items-center"]),onClick:j,children:n(V,{nameIcon:"BsTrashFill",propsIcon:{size:16,color:"white"}})}),n("span",{children:$()})]})},AutoCompleteFilterMultiSelectMultiFieldsDisplayDragDrop=({componentKey:r,uniqueField:c="_id",loader:y=!1,placeholder:N="Search...",data:i,hasError:h=!1,disable:O=!1,isUpperCase:L=!1,name:D,defaultValue:S="",displayConfig:d={},dragDropConfig:T={},selectionConfig:E={},uiConfig:R={},onFilter:x,onUpdate:$,onSelect:j,onBlur:v,className:z,style:A,filterDebounceDelay:H=300})=>{const{enabled:W=!0,strategy:K=$e,onDragEnd:F,animationDuration:Ce=200}=T,{maxSelection:k,onSelectionChange:f}=E,{showSelectedSection:ee=!0,selectedPlaceholder:B,emptyStateMessage:te="No items available",maxHeight:se="calc(100vh - 20vh)",zIndex:re=80}=R,ne=t=>{if(d.renderItem){const a=d.renderItem(t);if(typeof a=="string")return a}const s=d.displayKeys||i.displayKey||d.fallbackKeys||["name","code"],o=d.displaySeparator||" - ";return s.map(a=>t[a]).filter(Boolean).join(o)||"Unnamed Item"},[G,M]=_(""),[U,oe]=_([]),[Oe,le]=_([]),[w,J]=_(!1),u=q(i?.selected||[]),[p,C]=_(i?.selected||[]),ce=be(we(_e));P(()=>{S&&M(S)},[S]);const ae=t=>{P(()=>{function s(o){t.current&&!t.current.contains(o.target)&&w&&($(u.current),J(!1),M(""))}return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[t,w,$])},Q=q(null);ae(Q);const X=(t,s)=>s.map(o=>{const a=t&&t.length>0?t.some(m=>m[c]===o[c]):!1;return{...o,selected:a}});P(()=>{const t=i?.selected||[],s=i?.list||[];le(X(t,s)),oe(X(t,s));const o=t.map((a,m)=>({...a,sort:m.toString()}));u.current=o,C(o),f&&f(o)},[i,i?.selected,c,f]);const Y=Se.useMemo(()=>{if(!x)return()=>{};let t;return s=>{clearTimeout(t),t=setTimeout(()=>{x(s)},H)}},[x,H]),ie=t=>{const s=t.target.value;M(s),Y(s)},de=t=>{if((t.which?t.which:t.keyCode)===8){const o=t.currentTarget.value;Y(o)}},ue=t=>{if(!W)return;const{active:s,over:o}=t;if(!o||s.id===o.id)return;const a=u.current.findIndex(g=>g.sort===s.id||g[c]===s.id),m=u.current.findIndex(g=>g.sort===o.id||g[c]===o.id);if(a!==-1&&m!==-1){const I=ye(u.current,a,m).map((pe,ge)=>({...pe,sort:ge.toString()}));u.current=I,C([...I]),F&&F(I),f&&f(I)}},Z=t=>{const s=u.current?.slice(0,t)||[],o=u.current?.slice(t+1)||[],m=[...s,...o].map((g,I)=>({...g,sort:I.toString()}));u.current=m,C([...m]),f&&f(m)},me=t=>{k&&p.length>=k&&!t.selected||(j(t),setTimeout(()=>{const s=(i?.selected||[]).map((o,a)=>({...o,sort:a.toString()}));u.current=s,C(s),f&&f(s)},0))},fe=()=>{const t=p.length;return typeof B=="function"?B(t):B||`${t} Items`};return n(he,{children:b("div",{ref:Q,className:l(e["w-full"],e.relative,z),style:A,children:[b("div",{className:l(e.flex,e["items-center"],e["leading-4"],e["p-2"],e["focus:outline-none"],e["focus:ring"],e["w-full"],e["shadow-sm"],e["sm:text-base"],e.border,e["rounded-md"],{[e["border-red"]]:h,[e["border-gray-300"]]:!h}),children:[n("input",{placeholder:N,disabled:O,name:D,value:w?L?G?.toUpperCase():G:p.length>0?fe():N,className:l(e["w-full"],e["focus:outline-none"],e["bg-none"]),onKeyUp:de,onChange:ie,onClick:()=>J(!0),onBlur:t=>v&&v(t),id:r?`${r}_input_text`:void 0},r?`${r}_input`:void 0),y&&n(xe,{}),w?n(V,{nameIcon:"FaChevronUp",propsIcon:{size:16}}):n(V,{nameIcon:"FaChevronDown",propsIcon:{size:16}})]}),U&&w&&b("div",{className:l(e.flex,e["flex-col"],e.absolute,e["rounded-sm"],e["z-500"],e["w-full"]),style:{zIndex:re},children:[ee&&p.length>0&&n("div",{className:l(e.flex,e["w-full"],e["bg-gray-400"]),children:W?n(ve,{sensors:ce,collisionDetection:Ie,onDragEnd:ue,children:n(Ne,{items:p.map((t,s)=>t.sort||t[c]||s.toString()),strategy:K,children:n("div",{className:l(e.flex,e["flex-wrap"],e["gap-1"],e["bg-gray-400"],e["p-1"]),children:p.map((t,s)=>n(DraggableSelectedItem,{item:t,index:s,onRemove:Z,displayKey:i.displayKey,uniqueField:"sort",displayConfig:d},t.sort||t[c]||s))})})}):n("div",{className:l(e.flex,e["flex-wrap"],e["gap-1"],e["bg-gray-400"],e["p-1"]),children:p.map((t,s)=>n(DraggableSelectedItem,{item:t,index:s,onRemove:Z,displayKey:i.displayKey,uniqueField:c,displayConfig:d},t[c]||s))})}),U.length>0?n("ul",{className:l(e.flex,e["flex-col"],e["gap-1"],e["bg-gray-200"],e["p-2"],e["overflow-y-scroll"],e["w-full"]),id:r?`${r}_listView`:void 0,style:{maxHeight:se},children:U.map((t,s)=>n("li",{className:l(e.flex,e["gap-4"],e["p-1"]),children:b("label",{className:l(e.flex,e["items-center"]),children:[n("input",{className:l(e.flex,e["h-4"],e["w-4"]),type:"checkbox",checked:t.selected||!1,onChange:()=>me(t),disabled:k?p.length>=k&&!t.selected:!1,id:r?`${r}_${s}_check_box_view`:void 0},r?`${r}_${s}_check_box_view`:void 0),n("span",{className:l(e.flex,e["ml-2"]),children:d.renderItem?d.renderItem(t):ne(t)})]})},`${r||"item"}_${s}_list`))},r?`${r}_listView`:void 0):n("div",{className:l(e["p-4"],e["text-center"],e["text-gray-500"]),children:n("p",{className:l(e["text-sm"]),children:te})})]},r?`${r}_list_wrapper_view`:void 0)]},r?`${r}_wrapperView`:void 0)})};
