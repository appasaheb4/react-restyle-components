"use strict";import{jsx as s,jsxs as C,Fragment as oe}from"react/jsx-runtime";import{useState as r,useEffect as g,useRef as H,useCallback as T}from"react";import{Icon as se}from"../../Icon/Icon";import e from"../../../tc.module.css";import{cn as c}from"../../../utils";import{debounce as Y}from"@techabl/core-utils";const i={dropdown:{base:{transformOrigin:"top center",transition:"opacity 200ms ease-out, transform 200ms ease-out"},entering:{opacity:1,transform:"scaleY(1) translateY(0)"},exiting:{opacity:0,transform:"scaleY(0.95) translateY(-8px)"}},listItem:{base:{transition:"opacity 180ms ease-out, transform 180ms ease-out, background-color 150ms ease",cursor:"pointer"},visible:{opacity:1,transform:"translateX(0)"},hidden:{opacity:0,transform:"translateX(-12px)"},hover:{backgroundColor:"rgba(59, 130, 246, 0.1)"}},skeleton:{base:{background:"linear-gradient(90deg, #e5e7eb 25%, #f3f4f6 50%, #e5e7eb 75%)",backgroundSize:"200% 100%",animation:"shimmer 1.5s infinite",borderRadius:"4px"}},spinner:{animation:"spin 0.8s linear infinite",border:"2px solid #e5e7eb",borderTopColor:"#3b82f6",borderRadius:"50%",width:"16px",height:"16px"},fadeContent:{base:{transition:"opacity 200ms ease-out"},loading:{opacity:.5},ready:{opacity:1}}},ie=()=>{const p="autocomplete-animations";if(typeof document<"u"&&!document.getElementById(p)){const l=document.createElement("style");l.id=p,l.textContent=`
      @keyframes shimmer {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(8px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }
    `,document.head.appendChild(l)}},ae=({delay:p=0})=>C("div",{style:{display:"flex",alignItems:"center",padding:"8px 8px",gap:"12px",animation:`fadeInUp 300ms ease-out ${p}ms both`},children:[s("div",{style:{...i.skeleton.base,width:"60px",height:"14px"}}),s("div",{style:{...i.skeleton.base,flex:1,height:"14px",maxWidth:"180px"}})]}),re=()=>s("div",{style:i.spinner,role:"status","aria-label":"Loading"});export const AutoCompleteFilterSingleSelectMultiFieldsDisplay=({disable:p=!1,loader:l=!1,displayValue:S="",placeholder:_="Search...",data:a,hasError:j=!1,className:U,posstion:le="absolute",keyboard:z="text",classNames:y={},styles:b={},onFilter:w,onSelect:f,onBlur:E})=>{const[M,h]=r(S),[d,K]=r(a.list),[m,O]=r(!1),[de,W]=r(),[$,x]=r(!1),[B,u]=r(new Set),[V,R]=r(null),[N,D]=r(!1),[X,A]=r(!1);g(()=>{ie()},[]);const q=t=>{g(()=>{function n(o){t.current&&!t.current.contains(o.target)&&m&&v()}return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[t,m])},L=H(null),F=H(null);q(F);const G=T(()=>{O(!0),requestAnimationFrame(()=>{A(!0)})},[]),v=T(()=>{A(!1),setTimeout(()=>{O(!1)},200)},[]);g(()=>{m&&d.length>0&&!l&&(u(new Set),d.forEach((t,n)=>{setTimeout(()=>{u(o=>new Set([...o,n]))},Math.min(n*30,300))}))},[m,d,l]),g(()=>{if(N){x(!0);const t=setTimeout(()=>{K(a.list),x(!1),D(!1),u(new Set),a.list.forEach((n,o)=>{setTimeout(()=>{u(I=>new Set([...I,o]))},Math.min(o*25,200))})},150);return()=>clearTimeout(t)}else K(a.list)},[a]),g(()=>{h(S)},[S]);const J=t=>{const n=t.target.value;h(n),W(n),D(!0);const o=a.list.filter(I=>a.displayKey.some(k=>I[k]?.toString().toLowerCase().includes(n.toLowerCase())));x(!0),setTimeout(()=>{K(o),x(!1),D(!1),u(new Set),o.forEach((I,k)=>{setTimeout(()=>{u(ne=>new Set([...ne,k]))},Math.min(k*25,200))})},100),Y(()=>{w&&w(n)})},P=t=>{if((t.which?t.which:t.keyCode)===8){const o=t.target.value;Y(()=>{w&&w(o)})}},Q=t=>{if((t.key==="Enter"||t.key==="Tab")&&d.length>0){const n=d.find(o=>o.labId===Number(M));n&&(h(a.displayKey.map(o=>`${n[o]}`).join(" - ")),v(),f&&f(n))}},Z=()=>{if(L.current){const t=L.current.getBoundingClientRect();return window.innerHeight-t.bottom-20}return"calc(100vh - 140px)"},ee=T(t=>{h(a.displayKey.map(n=>t[n]).filter(n=>n!=null).join(" - ")),v(),f&&f(t)},[a.displayKey,f,v]),te=l||N;return s(oe,{children:C("div",{ref:F,className:c(e["w-full"],e.relative,y.container),style:b.container,children:[C("div",{className:c(e.flex,e["p-2"],e["leading-4"],e["focus:outline-none"],e["focus:ring"],e["w-full"],e["shadow-sm"],e["sm:text-base"],e.border,e["rounded-md"],e["transition-all"],e["duration-200"],{[e["border-red"]]:j,[e["border-gray-300"]]:!j,[e["dark:text-black"]]:!0},y.inputWrapper),style:{transition:"border-color 200ms ease, box-shadow 200ms ease",...b.inputWrapper},children:[s("input",{ref:L,placeholder:_,type:z,value:M,className:c(e["w-full"],e["focus:outline-none"],e["bg-none"],e["dark:text-black"],U,y.input),style:b.input,onKeyUp:P,onChange:J,onClick:G,disabled:p,onMouseDown:()=>h(""),onBlur:t=>E&&E(t),onKeyDown:Q}),C("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[te&&s(re,{}),s("div",{style:{transition:"transform 200ms ease",transform:m?"rotate(180deg)":"rotate(0deg)"},children:s(se,{nameIcon:"FaChevronDown",propsIcon:{size:16}})})]})]}),m&&s("div",{className:c(e.absolute,e["w-full"],e["bg-white"],e["rounded-md"],e["shadow-lg"],e["overflow-hidden"],y.dropdown),style:{...i.dropdown.base,...X?i.dropdown.entering:i.dropdown.exiting,zIndex:500,marginTop:"4px",border:"1px solid #e5e7eb",...b.dropdown},children:s("div",{className:c(e["overflow-y-auto"],e["p-1"]),style:{maxHeight:`${Z()}px`,...i.fadeContent.base,...$?i.fadeContent.loading:i.fadeContent.ready},children:l?s("div",{style:{padding:"4px 0"},children:[0,1,2,3,4].map(t=>s(ae,{delay:t*50},t))}):d.length>0?s("ul",{style:{listStyle:"none",margin:0,padding:0},children:d.map((t,n)=>s("li",{className:c(e.flex,e["items-center"]),onClick:()=>ee(t),onMouseEnter:()=>R(n),onMouseLeave:()=>R(null),style:{...i.listItem.base,...B.has(n)?i.listItem.visible:i.listItem.hidden,...V===n?i.listItem.hover:{},padding:"10px 12px",borderRadius:"6px",margin:"2px 0",transitionDelay:`${Math.min(n*20,150)}ms`},children:s("label",{className:c(e["text-gray-700"]),style:{textOverflow:"ellipsis",minWidth:0,overflow:"hidden",whiteSpace:"nowrap",cursor:"pointer",fontSize:"14px"},title:a.displayKey.map(o=>t[o]).join(" - "),children:a.displayKey.map(o=>t[o]).filter(o=>o!=null).join(" - ")})},n))}):s("div",{style:{padding:"16px",textAlign:"center",color:"#6b7280",animation:"fadeInUp 200ms ease-out"},children:s("span",{children:"No results found"})})})})]})})};
